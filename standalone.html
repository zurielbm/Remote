<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProPresenter Slide Viewer Standalone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f3f0ff',
                            100: '#e9e5ff',
                            200: '#d6ccff',
                            300: '#b8a5ff',
                            400: '#9575ff',
                            500: '#7c3aed',
                            600: '#6d28d9',
                            700: '#5b21b6',
                            800: '#4c1d95',
                            900: '#3b1a78'
                        },
                        accent: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d'
                        },
                        neutral: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a'
                        },
                        brown: {
                            50: '#fdf8f6',
                            100: '#f2e8e5',
                            200: '#eaddd7',
                            300: '#e0cec7',
                            400: '#d2bab0',
                            500: '#bfa094',
                            600: '#a18072',
                            700: '#8b6f47',
                            800: '#6f5f52',
                            900: '#5c4f44'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes shimmer {
            0% {
                background-position: -200px 0;
            }

            100% {
                background-position: calc(200px + 100%) 0;
            }
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200px 100%;
            animation: shimmer 1.5s infinite;
        }

        .dark .skeleton {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200px 100%;
        }

        .placeholder-image {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark .placeholder-image {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
        }
    </style>
</head>

<body
    class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 text-gray-900 dark:text-white m-0 min-h-screen flex flex-col items-center p-4 font-sans transition-colors duration-300">
    <!-- Header with theme toggle -->
    <div class="w-full max-w-6xl flex justify-between items-center mb-6 md:mb-8">
        <div class="flex-1"></div>
        <div class="text-center">
            <h1 class="text-primary-600 dark:text-primary-400 text-2xl md:text-4xl font-bold">
                ProPresenter Slide Clicker
            </h1>
            <p class="text-sm md:text-base text-gray-500 dark:text-gray-400 font-medium mt-1">Standalone Version</p>
        </div>
        <div class="flex-1 flex justify-end">
            <button onclick="toggleTheme()"
                class="p-2 rounded-lg bg-white dark:bg-gray-800 shadow-lg hover:shadow-xl transition-all duration-200 border border-gray-200 dark:border-gray-700">
                <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5 text-gray-600 dark:text-gray-300"
                    fill="currentColor" viewBox="0 0 20 20">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                </svg>
                <svg id="theme-toggle-light-icon" class="w-5 h-5 text-gray-600 dark:text-gray-300" fill="currentColor"
                    viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                        clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>
    </div>

    <div id="presentationName"
        class="text-sm md:text-lg mb-4 md:mb-6 text-primary-600 dark:text-primary-400 text-center px-2 font-medium">
    </div>
    <div id="error" class="text-red-500 dark:text-red-400 mb-4 md:mb-6 text-center px-2 font-medium"></div>

    <div class="w-full max-w-6xl mb-6 md:mb-8 px-2">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
            <!-- Current Slide Card -->
            <div
                class="bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 p-4 md:p-6 border border-gray-200 dark:border-gray-700 fade-in">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <h2 class="text-lg md:text-xl font-bold text-gray-800 dark:text-white">Current Slide</h2>
                </div>
                <div id="currentSlideText" class="mb-4 relative">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <p
                                class="content min-h-16 text-sm md:text-base text-gray-700 dark:text-gray-300 leading-relaxed p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                No content available</p>
                        </div>
                        <div class="md:w-48 w-full">
                            <img id="slideThumbnail"
                                class="w-full rounded-lg shadow-md border border-gray-200 dark:border-gray-600" src=""
                                alt="Slide Thumbnail">
                        </div>
                    </div>
                    <!-- Skeleton Loading State -->
                    <div id="loadingSkeleton"
                        class="hidden absolute inset-0 bg-white dark:bg-gray-800 bg-opacity-95 rounded-lg">
                        <div class="flex flex-col md:flex-row gap-4 h-full">
                            <div class="flex-1">
                                <div class="skeleton rounded-lg h-16 mb-2"></div>

                            </div>
                            <div class="md:w-48 w-full">
                                <div
                                    class="placeholder-image w-full h-32 md:h-full rounded-lg border border-gray-200 dark:border-gray-600">
                                    <svg class="w-12 h-12 text-gray-400 dark:text-gray-500" viewBox="0 0 24 24"
                                        fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M14.2639 15.9375L12.5958 14.2834C11.7909 13.4851 11.3884 13.086 10.9266 12.9401C10.5204 12.8118 10.0838 12.8165 9.68048 12.9536C9.22188 13.1095 8.82814 13.5172 8.04068 14.3326L4.04409 18.2801M14.2639 15.9375L14.6053 15.599C15.4112 14.7998 15.8141 14.4002 16.2765 14.2543C16.6831 14.126 17.12 14.1311 17.5236 14.2687C17.9824 14.4251 18.3761 14.8339 19.1634 15.6514L20 16.4934M14.2639 15.9375L18.275 19.9565M18.275 19.9565C17.9176 20 17.4543 20 16.8 20H7.2C6.07989 20 5.51984 20 5.09202 19.782C4.71569 19.5903 4.40973 19.2843 4.21799 18.908C4.12796 18.7313 4.07512 18.5321 4.04409 18.2801M18.275 19.9565C18.5293 19.9256 18.7301 19.8727 18.908 19.782C19.2843 19.5903 19.5903 19.2843 19.782 18.908C20 18.4802 20 17.9201 20 16.8V16.4934M4.04409 18.2801C4 17.9221 4 17.4575 4 16.8V7.2C4 6.0799 4 5.51984 4.21799 5.09202C4.40973 4.71569 4.71569 4.40973 5.09202 4.21799C5.51984 4 6.07989 4 7.2 4H16.8C17.9201 4 18.4802 4 18.908 4.21799C19.2843 4.40973 19.5903 4.71569 19.782 5.09202C20 5.51984 20 6.0799 20 7.2V16.4934M17 8.99989C17 10.1045 16.1046 10.9999 15 10.9999C13.8954 10.9999 13 10.1045 13 8.99989C13 7.89532 13.8954 6.99989 15 6.99989C16.1046 6.99989 17 7.89532 17 8.99989Z"
                                            stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="currentSlideNotes"
                    class="text-sm text-gray-500 dark:text-gray-400 italic bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                </div>
            </div>

            <!-- Next Slide Card -->
            <div
                class="bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 p-4 md:p-6 border border-gray-200 dark:border-gray-700 fade-in">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                    <h2 class="text-lg md:text-xl font-bold text-gray-800 dark:text-white">Next Slide</h2>
                </div>
                <div id="nextSlideText" class="mb-4 relative">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <p
                                class="content min-h-16 text-sm md:text-base text-gray-700 dark:text-gray-300 leading-relaxed p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                No content available</p>
                        </div>
                        <div class="md:w-48 w-full hidden md:block">
                            <img id="nextSlideThumbnail"
                                class="w-full rounded-lg shadow-md border border-gray-200 dark:border-gray-600" src=""
                                alt="Next Slide Thumbnail">
                        </div>
                    </div>
                    <!-- Next Slide Skeleton Loading State -->
                    <div id="nextLoadingSkeleton"
                        class="hidden absolute inset-0 bg-white dark:bg-gray-800 bg-opacity-95 rounded-lg">
                        <div class="flex flex-col md:flex-row gap-4 h-full">
                            <div class="flex-1">
                                <div class="skeleton rounded-lg h-16 mb-2"></div>
                            </div>
                            <div class="md:w-48 w-full hidden md:block">
                                <div
                                    class="placeholder-image w-full h-32 md:h-full rounded-lg border border-gray-200 dark:border-gray-600">
                                    <svg class="w-12 h-12 text-gray-400 dark:text-gray-500" viewBox="0 0 24 24"
                                        fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M14.2639 15.9375L12.5958 14.2834C11.7909 13.4851 11.3884 13.086 10.9266 12.9401C10.5204 12.8118 10.0838 12.8165 9.68048 12.9536C9.22188 13.1095 8.82814 13.5172 8.04068 14.3326L4.04409 18.2801M14.2639 15.9375L14.6053 15.599C15.4112 14.7998 15.8141 14.4002 16.2765 14.2543C16.6831 14.126 17.12 14.1311 17.5236 14.2687C17.9824 14.4251 18.3761 14.8339 19.1634 15.6514L20 16.4934M14.2639 15.9375L18.275 19.9565M18.275 19.9565C17.9176 20 17.4543 20 16.8 20H7.2C6.07989 20 5.51984 20 5.09202 19.782C4.71569 19.5903 4.40973 19.2843 4.21799 18.908C4.12796 18.7313 4.07512 18.5321 4.04409 18.2801M18.275 19.9565C18.5293 19.9256 18.7301 19.8727 18.908 19.782C19.2843 19.5903 19.5903 19.2843 19.782 18.908C20 18.4802 20 17.9201 20 16.8V16.4934M4.04409 18.2801C4 17.9221 4 17.4575 4 16.8V7.2C4 6.0799 4 5.51984 4.21799 5.09202C4.40973 4.71569 4.71569 4.40973 5.09202 4.21799C5.51984 4 6.07989 4 7.2 4H16.8C17.9201 4 18.4802 4 18.908 4.21799C19.2843 4.40973 19.5903 4.71569 19.782 5.09202C20 5.51984 20 6.0799 20 7.2V16.4934M17 8.99989C17 10.1045 16.1046 10.9999 15 10.9999C13.8954 10.9999 13 10.1045 13 8.99989C13 7.89532 13.8954 6.99989 15 6.99989C16.1046 6.99989 17 7.89532 17 8.99989Z"
                                            stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="nextSlideNotes"
                    class="text-sm text-gray-500 dark:text-gray-400 italic bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                </div>
            </div>
        </div>
    </div>

    <!-- Control Buttons -->
    <div class="w-full max-w-6xl mb-8 px-2">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
            <button onclick="handlePrevious()"
                class="group px-8 py-4 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 dark:from-primary-500 dark:to-primary-600 dark:hover:from-primary-600 dark:hover:to-primary-700 text-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-3 text-lg font-semibold transform hover:scale-105">
                <svg class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Previous
            </button>
            <button onclick="handleNext()"
                class="group px-8 py-4 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 dark:from-primary-500 dark:to-primary-600 dark:hover:from-primary-600 dark:hover:to-primary-700 text-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-3 text-lg font-semibold transform hover:scale-105">
                Next
                <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Settings Section -->
    <div class="w-full max-w-4xl mb-8 px-2">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
            <div class="flex items-center gap-3 mb-6">
                <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <h3 class="text-lg font-bold text-gray-800 dark:text-white">ProPresenter Settings</h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">ProPresenter IP
                        Address</label>
                    <input type="text" id="ipInput" placeholder="192.168.1.100"
                        class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-all duration-200">
                </div>
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">ProPresenter Port</label>
                    <input type="text" id="portInput" placeholder="1025"
                        class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-all duration-200">
                </div>
                <div class="flex items-end">
                    <button onclick="updateBaseUrl()"
                        class="w-full px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 font-medium flex items-center justify-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        Update
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let baseUrl = localStorage.getItem('baseUrl') || 'http://192.168.50.81:1025';
        let currentSlide = 0;
        let activePresentation = null;
        let slideStatus = null;
        let errorTimeout = null;

        // Theme toggle functionality
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');

            if (isDark) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                document.getElementById('theme-toggle-dark-icon').classList.remove('hidden');
                document.getElementById('theme-toggle-light-icon').classList.add('hidden');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                document.getElementById('theme-toggle-dark-icon').classList.add('hidden');
                document.getElementById('theme-toggle-light-icon').classList.remove('hidden');
            }
        }

        // Initialize theme on page load
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const shouldBeDark = savedTheme === 'dark' || (!savedTheme && prefersDark);

            if (shouldBeDark) {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-toggle-dark-icon').classList.add('hidden');
                document.getElementById('theme-toggle-light-icon').classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('theme-toggle-dark-icon').classList.remove('hidden');
                document.getElementById('theme-toggle-light-icon').classList.add('hidden');
            }
        }

        function setError(message) {
            const errorElement = document.getElementById('error');
            errorElement.textContent = message;
            errorElement.classList.remove('opacity-0');

            if (errorTimeout) {
                clearTimeout(errorTimeout);
            }

            errorTimeout = setTimeout(() => {
                errorElement.classList.add('opacity-0');
            }, 3000);
        }

        function updateBaseUrl() {
            const ipInput = document.getElementById('ipInput');
            const portInput = document.getElementById('portInput');

            const ip = ipInput.value.trim();
            const port = portInput.value.trim();

            if (ip && port) {
                const newBaseUrl = `http://${ip}:${port}`;
                baseUrl = newBaseUrl;
                localStorage.setItem('baseUrl', newBaseUrl);

                // Clear the input fields
                ipInput.value = '';
                portInput.value = '';

                // Refresh the data with the new URL
                fetchActivePresentation();
                fetchSlideStatus();

                setError('Base URL updated successfully!');
            } else {
                setError('Please enter both IP and Port');
            }
        }

        function displayCurrentUrl() {
            const ipInput = document.getElementById('ipInput');
            const portInput = document.getElementById('portInput');

            // Extract IP and port from the current baseUrl
            const url = new URL(baseUrl);
            ipInput.placeholder = `Current IP: ${url.hostname}`;
            portInput.placeholder = `Current Port: ${url.port}`;
        }

        async function fetchSlideStatus() {
            try {
                const response = await fetch(`${baseUrl}/v1/status/slide`);
                if (!response.ok) throw new Error('Failed to fetch slide status');
                const data = await response.json();
                slideStatus = data;
                updateSlideDisplay();
                await fetchSlideThumbnail();
                await fetchNextSlideThumbnail();
            } catch (err) {
                setError(err instanceof Error ? err.message : 'Failed to fetch slide status');
            }
        }

        document.addEventListener('DOMContentLoaded', async function () {
            try {
                initializeTheme();
                displayCurrentUrl();
                await fetchActivePresentation();
                await fetchSlideStatus();
            } catch (err) {
                setError(err instanceof Error ? err.message : 'Failed to initialize data');
            }
        });

        async function fetchActivePresentation() {
            try {
                const response = await fetch(`${baseUrl}/v1/presentation/active`);
                if (!response.ok) throw new Error('Failed to fetch active presentation');
                const data = await response.json();
                activePresentation = data;

                const slideIndexResponse = await fetch(`${baseUrl}/v1/presentation/slide_index`);
                if (slideIndexResponse.ok) {
                    const { presentation_index } = await slideIndexResponse.json();
                    currentSlide = presentation_index.index;
                }
                updatePresentationDisplay();
            } catch (err) {
                setError(err instanceof Error ? err.message : 'Failed to fetch presentation data');
            }
        }

        function updateSlideDisplay() {
            if (slideStatus) {
                const currentTextElement = document.getElementById('currentSlideText');
                const nextTextElement = document.getElementById('nextSlideText');
                const currentContentSpan = currentTextElement.querySelector('.content');
                const nextContentSpan = nextTextElement.querySelector('.content');

                currentContentSpan.textContent = slideStatus.current?.text || 'No content available';
                nextContentSpan.textContent = slideStatus.next?.text || 'No content available';

                document.getElementById('currentSlideNotes').textContent = slideStatus.current?.notes ? `Notes: ${slideStatus.current.notes}` : '';
                document.getElementById('nextSlideNotes').textContent = slideStatus.next?.notes ? `Notes: ${slideStatus.next.notes}` : '';

                document.getElementById('loadingSkeleton').classList.add('hidden');
                document.getElementById('nextLoadingSkeleton').classList.add('hidden');
            }
        }

        async function handlePrevious() {
            try {
                document.getElementById('loadingSkeleton').classList.remove('hidden');

                const response = await fetch(`${baseUrl}/v1/presentation/active/previous/trigger`, {
                    method: 'GET'
                });

                if (!response.ok) {
                    throw new Error('Failed to trigger previous slide');
                }

                if (currentSlide > 0) {
                    currentSlide--;
                    await fetchSlideStatus();
                    await fetchActivePresentation(); // Ensure activePresentation is updated
                }
            } catch (err) {
                setError(err instanceof Error ? err.message : 'Failed to trigger previous slide');
                document.getElementById('loadingSkeleton').classList.add('hidden');
            }
        }

        async function handleNext() {
            try {
                document.getElementById('nextLoadingSkeleton').classList.remove('hidden');
                const response = await fetch(`${baseUrl}/v1/presentation/active/next/trigger`, { method: 'GET' });
                if (!response.ok) throw new Error('Failed to trigger next slide');
                currentSlide++;
                await fetchSlideStatus();
                await fetchActivePresentation(); // Ensure activePresentation is updated
            } catch (err) {
                setError(err instanceof Error ? err.message : 'Failed to trigger next slide');
                document.getElementById('nextLoadingSkeleton').classList.add('hidden');
            }
        }

        setInterval(async function () {
            try {
                await fetchActivePresentation();
                await fetchSlideStatus();
            } catch (err) {
                setError(err instanceof Error ? err.message : 'Failed to refresh data');
            }
        }, 10000);

        async function fetchSlideThumbnail() {
            try {
                document.getElementById('loadingSkeleton').classList.remove('hidden'); // Show skeleton
                const response = await fetch(`${baseUrl}/v1/presentation/${activePresentation.presentation.id.uuid}/thumbnail/${currentSlide}?quality=400`);
                console.log(`${baseUrl}/v1/presentation/${activePresentation.presentation.id.uuid}/thumbnail/${currentSlide}?quality=400`);
                if (!response.ok) throw new Error('Failed to fetch slide thumbnail');
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                document.getElementById('slideThumbnail').src = url;
                document.getElementById('slideThumbnail').style.display = 'block'; // Show thumbnail
            } catch (err) {
                setError(err instanceof Error ? err.message : 'Failed to fetch slide thumbnail');
                document.getElementById('slideThumbnail').style.display = 'none'; // Hide thumbnail
            } finally {
                document.getElementById('loadingSkeleton').classList.add('hidden'); // Hide skeleton
            }
        }

        async function fetchNextSlideThumbnail() {
            try {
                document.getElementById('nextLoadingSkeleton').classList.remove('hidden'); // Show skeleton
                const response = await fetch(`${baseUrl}/v1/presentation/${activePresentation.presentation.id.uuid}/thumbnail/${currentSlide + 1}?quality=400`);
                console.log("Next Slide");
                console.log(`${baseUrl}/v1/presentation/${activePresentation.presentation.id.uuid}/thumbnail/${currentSlide + 1}?quality=400`);
                if (!response.ok) throw new Error('Failed to fetch slide thumbnail');
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                document.getElementById('nextSlideThumbnail').src = url;
                document.getElementById('nextSlideThumbnail').style.display = 'block'; // Show thumbnail
            } catch (err) {
                console.log(activePresentation.presentation.groups)
                setError(err instanceof Error ? err.message : 'Failed to fetch slide thumbnail');
                document.getElementById('nextSlideThumbnail').style.display = 'none'; // Hide thumbnail
            } finally {
                document.getElementById('nextLoadingSkeleton').classList.add('hidden'); // Hide skeleton
            }
        }

        function updatePresentationDisplay() {
            const presentationElement = document.getElementById('presentationName');
            console.log(activePresentation);
            if (activePresentation && activePresentation.presentation && activePresentation.presentation) {
                presentationElement.textContent = `Current Presentation: ${activePresentation.presentation.id.name}`;
            } else {
                presentationElement.textContent = 'No active presentation';
            }
        }
    </script>

    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        #error {
            transition: opacity 0.5s ease-in-out;
        }

        .opacity-0 {
            opacity: 0;
        }
    </style>
</body>

</html>